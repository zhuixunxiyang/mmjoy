**MMJoy**( продолжение MJoy MJoy8 MJoy16 )<br>
проект USB джойстика для PC на аппаратной платформе МК Atmel megaAVR.<br>
Аппаратная часть основана на проектах "MJoy", "MJoy16" и платах разработки "METABOARD" и "AVR_USB_MEGA16".<br>
Программная часть состоит из прошивки МК, и программы конфигуратора для PC ОС Windows.<br>
<br>
<br>
<hr><br>
<br>
<br>
<b>На текущий момент новую прошивку можно скомпилировать для следующего железа:</b><br>
1) USB 1.1(V-USB) - MJoy8, на возможных контроллерах atmega8/atmega168/atmega328/atmega328p, кварцы 12/16/20Mhz; в makefile "HARDWARE=1";<br>
2) USB 1.1(V-USB) - MJoy16, на возможных контроллерах atmega16a/atmega32, кварцы 12/16/20Mhz; в makefile "HARDWARE=2";<br>
3) USB 1.1(V-USB) - METABOARD(microsin), обычно поставляется в комплекте контроллер atmega328 кварц 12Mhz; в makefile "HARDWARE=3";<br>
4) USB 1.1(V-USB) - AVR_USB_MEGA16(microsin), обычно поставляется в комплекте контроллер atmega32a кварц 12Mhz; в makefile "HARDWARE=4";<br>
5) USB 1.1(V-USB) - MJoy8_35Btn, на возможных контроллерах atmega168/atmega328/atmega328p, кварцы 12/16/20Mhz; в makefile "HARDWARE=5"; модификация "MJoy8" до 35 аппаратных кнопок;<br>
6) USB 1.1(V-USB) - MMjoy, адаптированная схема 2013, 6 осей и 36 кнопок;<br>
7) USB 2.0(LUFA) - MMJOY2.a AT90USB646, 8 осей и 64 кнопки.<br>
8) USB 2.0(LUFA) - MMJOY2.b ATMEGA32U4-ProMicro, 6 осей и 36 кнопок, на базе готовой платы "Arduino Pro Micro".<br>
9) USB 2.0(LUFA) - MMJOY2.c ATMEGA32U4-Teensy2, 8 осей и 64 кнопки, на базе готовой платы "Teensy2".<br>
<br>
<br>
<hr><br>
<br>
<br>
<b>Возможности прошивки</b><br>
Програмная реализация протокола USB 1.1 через библиотеку через V-USB<br>
Реализация протокола USB 2.0 через библиотеку LUFA<br>
Поддержка разных кварцев 12, 16 и 20 Мгц для одной и той же разводки платы.<br>
Отправка до 120 USB пакетов в секунду(для USB 1.1).<br>
Отправка до 500 USB пакетов в секунду(для USB 2.0).<br>
Возможность задания "PID", "VID" и Названия устройства - для разделения двух и более устройств одновременно подключенных к одному компьютеру.<br>
Поддержка всех возможных портов АЦП микроконтроллера на точности 10бит.<br>
Поддержка внешних АЦП MCP3201/MCP3202/MCP3204/MCP3208 и КМА200 по протоколу SPI.<br>
Возможность многократного повторного опроса АЦП, т.н. функция фильтра (усреднения данных) для шумных датчиков.<br>
Опрос матрицы кнопок, всего до 64 кнопок.<br>
Подключние до четырех энкодеров.<br>
Хранение конфигурации в EEPROM, передача и прием настройки программе конфигуратору через USB.<br>

<b>Возможности конфигуратора</b><br>
Настройка USB параметров устройства(VID/PID и т.д.).<br>
Настройка скорости опроса USB (Poll).<br>
Отображение чистых физических данных, значений АЦП и матрицы кнопок.<br>
Справочное отображение аппаратной платформы, частоты кварца и времени жизни устройства(рассчитывается c момента подключения в USB).<br>
Включение/выключение нужных пользователю осей и кнопок, хаток<br>
Настройка датчиков осей: канал АЦП, фильтр и инвертирование данных<br>
Назначение оси X, Y, Throttle(газ), Wheel(руль) и т.д.<br>
Переключение режимов для оси:<br>
абсолютная ось - физически соответствует показателям АЦП.<br>
относительная ось - логическая ось увеличивает или уменьшает значение в зависимости от силы отклонения от физического центра.<br>
виртуальная(кнопочная) ось - не зависит от АЦП, увеличивает или уменьшает значение только от нажатия заданных кнопок.<br>
Специальная фукнция оси Стоп: позволяет временно заморозить значение оси в момент нажатия заданой кнопки.<br>
Специальная функция оси Зум: позволяет временно снизить чувствительность оси в заданное количество раз.(например вдвое, т.е. ручка джойстика отклоняется на полный ход, а виртуальный джойстик передает только половину перемещения - т.е. получается снайперский режим, мягкое и плавное доруливание на цель.)<br>
функции "стоп" и "зум" впервые были реализованы на контроллерах автора Станислав Казаков "kreml", и отдельная благодарность ему за возможность повторить их тут.<br>
Автокалибровка датчика оси: первые две секунды (после включения) устройство считывает и запоминает позицию центра. Далее необходимо отклонить ручку джойстика до упора во всех направлениях - устройство запомнит минимальное и максимальное положение датчика.<br>
Тример оси<br>

Режимы кнопок/тумблеров:<br>
1) Обычный/стандартный режим - физ.кнопка(матрица кнопок) включена - логическая(в джойстике) тоже будет включена; в конфигураторе обозначаются [01-96].<br>
2) Физ.тумблер-вкл - логическая кнопка разово включается в момент нажатия физической кнопки (на дальнейшее удержание физ.кнопки никак не реагирует); в конфигураторе обозначаются [01в-96в].<br>
3) Физ.тумблер-выкл(отключено) - логическая кнопка разово включается в момент отжатия физической кнопки (на дальнейшее удержание физ.кнопки никак не реагирует); в конфигураторе обозначаются [01о-96о].<br>
4) Логический/программный тумблер(переключение) - логическая кнопка переключает и удерживает свое состояние в момент нажатия физ.кнопки.; в конфигураторе обозначаются [01п-96п].<br>
Также конфигуратор позволяет сбросить калибровку устройства в ОС.<br>
<br>
<br>
<hr><br>
<br>
<br>
<br>
<b>Дальнейшие планы и идеи</b><br>
1) попытаться добавить функции "трекера" на основе аналоговых 3х осевых акселерометров, путем подключения выходов акселерометра X/Y/Z к аналоговым входам АЦП и расчет углов крена и тангажа, с последующей трансляцией данных в оси джойстика X и Y.<br>
<br>
<br>
<br>
<hr><br>
<br>
<br>
<br>
<b>История становления и развития</b><br>
в 2004 году,<br>
Mindaugas Milasauskas "MeanDog" на форуме "www.sukhoi.ru" впервые рассказывает о своей разработке:<br>
<i>Привет всем,</i><br>
<i>Сегодня заставил работать свой USB контролер джоистика на ATMega8.</i><br>
<i>Пока все на макетке и толко 2 оси по 10 бит. Но расширить и доделать проблем уже небудет.</i><br>
<a href='http://mmjoy.googlecode.com/svn/wiki/mjoy_pro_1.JPG'>http://mmjoy.googlecode.com/svn/wiki/mjoy_pro_1.JPG</a><br>
это был прототип "MJoy"(часто встречается название "MJoy8"), USB-контроллер джойстика на основе микроконтроллера AVR ATMega8.<br>
Основан на проекте контроллера "USB в RS232" от Igor Cesko. Написан на ассебмлере, и имеет открытые исходные тексты.<br>
В итоге "MJoy" вырос до продукта "6 осей(2 оси точностью 10бит, 4 оси по 8бит) и 28 кнопок (4 из них хатка)"<br>
<a href='http://mmjoy.googlecode.com/svn/wiki/mjoy.JPG'>http://mmjoy.googlecode.com/svn/wiki/mjoy.JPG</a><br>

в 2005 году,<br>
появляется новый проект "MJoy16" - "Многофункциональный контроллер для домашнего копита", уже используется другой МК ATMega16. новый контроллер поддерживает 8 осей 10бит точностью, 64 кнопки, 16 тублеров и 4 энкодера.<br>
Исходных текстов нет.<br>
<img src='http://mmjoy.googlecode.com/svn/wiki/MJoy16.jpg' /><br>
<img src='http://mmjoy.googlecode.com/svn/wiki/MJoy16_key.jpg' /><br>

2007/2011 год,<br>
проект "MJoy", благодаря открытым исходным текстам, продолжает развиваться руками умельцев "LazyCamel" и Михаил Меркурьев "Mercury". Появляются новые прошивки и версии разводки плат.<br>
<a href='http://mmjoy.googlecode.com/svn/wiki/Mjoy16_mod1.JPG'>http://mmjoy.googlecode.com/svn/wiki/Mjoy16_mod1.JPG</a><br>
<a href='http://mmjoy.googlecode.com/svn/wiki/Mjoy16_mod2.JPG'>http://mmjoy.googlecode.com/svn/wiki/Mjoy16_mod2.JPG</a><br>

2012 год,<br>
по идеологии исходных текстов "MJoy", напиcанный на "C" с использованием библиотеки "V-USB" появляется первая версия "MMJoy" для плат на контроллере ATMega8.<br>
Проект впервые был дополнен программой конфигуратором для PC. Конфигуратор позволяет настраивать используемые/неиспользуемые оси и кнопки, задавать названия осей и т.д.<br>

2013 год(начало),<br>
"MMJoy" вырастает в универсальную платформу способную работать на разных МК Atmega16/32/168/328 и разных версиях разводки плат. "MMJoy" может поддерживать до 8 осей 10 бит точностью и матрицу на 96 кнопок (колонок 8, строк 12).<br>

2013 год(окончание),<br>
"MMJoy" проект портируется на микроконтроллеры с аппаратным USB "AT90USB646" и "ATMEGA32U4". Используются как родные схемы плат, так и готовые макетные платы "Arduino ProMicro" и "Teensy2"<br>

Проект имеет открытые исходные тексты прошивки и программы конфигуратора.<br>
<br>
<br>
<hr><br>
<br>
<br>
<b>Ссылки:</b><br>
Исходная ветка обсуждения на форуме sukhoi.ru <a href='http://www.sukhoi.ru/forum/showthread.php?t=24406'>http://www.sukhoi.ru/forum/showthread.php?t=24406</a><br>
Инструкции сборки "MJoy/MJoy8/MJoy16" на сайте joysticks.ru <a href='http://www.joysticks.ru/joysticks/handmade/'>http://www.joysticks.ru/joysticks/handmade/</a><br>
Инструкции сборки "MJoy/MJoy8/MJoy16" на страничке Михаил Меркурьев "Mercury" <a href='http://mercury13.tut.su/?q=mjoy'>http://mercury13.tut.su/?q=mjoy</a><br>
Контроллер от Станислав Казаков "kreml" <a href='http://www.sukhoi.ru/forum/showthread.php?t=64206'>http://www.sukhoi.ru/forum/showthread.php?t=64206</a><br>
<br>
<br>
<hr><br>
<br>
<br>
Программирование: Виталий "mega_mozg"  Найденцев<br>
e-mail: mega_mozg@tut.by; icq: 199-374-588; skype: mega_mozg_13<br>
<br>
Аппаратные модификации: Владимир "china" Никитин<br>
e-mail: neekeeteen@hotmail.com; icq: 223-709-196; skype: neekeeteen<br>